= Guillotine application

Once assigned to your site, 
the guillotine application will generate a dynamic GraphQL API that enables web-based access to all your editorial content.

Guillotine exposes the read-only part of the Enonic Content API, including access to the Enonic query language. 
Guillotine dynamically analyzes all available content types in the site and generates a GraphQL API specific to your site. 
This gives you direct, typed and documented access to all content within the site. Including the ability to follow references, 
child items and access media directly.


[NOTE] 
.GraphQL
==== 
GraphQL is a query language developed by Facebook. 
This technology allows Guillotine to provide a single and exhaustive API 
while allowing you to retrieve all the content information you need in one request without any superfluous information

http://graphql.org/learn[Learn more about GraphQL...]
====

== Installation

* Open the admin tool "Applications"
* Search for the "guillotine" application
* Click on "install"

image::images/installation.png[Installation,768,384]

== Configuration

* Open the admin tool "Content Studio"
* Edit a site
* Add the application "Guillotine"

image::images/configuration.png[Installation,768,576]

== Usage

Once a site is configured with the Guillotine application, a service "graphql" is present under the site path. 
Example: "http://localhost:8080/mysite/mypage/_/service/com.enonic.app.guillotine/graphql".

=== GraphiQL

The easiest way to manually explore a GraphQL API and test GraphQL queries is to use GraphiQL

link:graphiql.html[Learn more about GraphiQL...]

=== Client

To use your GraphQL service, your client will send all its requests to the same service.
The service is expecting to receive a POST request with inside its body:

* A mandatory "query" String
* An optional "variables" Object

==== Example: Generate a service URL from a controller

[source,javascript]
----
var portalLib = require('/lib/xp/portal');
var graphqlServiceUrl = portalLib.serviceUrl({
    service: 'graphql'
});
----

==== Example: Fetch data from client javascript
[source,javascript]
----
const query = `query($path:ID!){
    guillotine {
        get(key:$path) {
            displayName
            type
        }
    }
}`;

const variables = {
    'path': '/mycontentpath'
};

fetch('{{graphqlServiceUrl}}', {
    method: 'POST',
    body: JSON.stringify({
        query: query,
        variables: variables
    }),
    credentials: 'same-origin'
})
    .then(response => response.json())
    .then(console.log);
----

== Guillotine GraphQL API

At the root of the default Guillotine schema is a type `Query` with a field `guillotine` of type `HeadlessCms`.
The `HeadlessCms` type gathers fields allowing to retrieve contents or related data.

=== Content

The type `Content` is an interface with multiple implementations generated from built-in content types but also from content types defined by the applications assigned to your site.
All types implementing `Content` share the same fields at the exception of the field `data` defined for each implementation type.


=== Relations

Multiple relations are generated to allow to navigate between contents.
By default, each content has the following relations:

* parent: Link to the parent content 
* children: Link to the child contents
* site: Link to the nearest site content

Moreover, every ContentSelector, MediaUploader, AttachmentUploader or ImageSelector defined in your content type form will 
be converted to a link to the related content(s).

==== Example: Children 

Query example: Retrieve the display name of the current content and the display name of its direct children

----
{
  guillotine {
    get {
      displayName
      children {
        displayName
      }
    }
  }
}
----

==== Example: ContentSelector

Query example: Retrieve the blog posts. For each post, return its display name and the display name of the related author

----
{
  guillotine {
    query(contentTypes:"com.enonic.app.myapp:post") {
      displayName
      ... on com_enonic_app_myapp_Post {
        data {          
          author {
            displayName
          }
        }
      }
    }
  }
}
----

=== Image

Enonic XP can edit images at runtime. Guillotine uses this functionality by generating, on every image, a field "imageUrl" generating a URL pointing to the processed image.

==== Example: Scaled Image URL

Query example: Retrieve the image contents and generate absolute URLs to these images cropped to 800x200px

----
{
  guillotine {
    query(contentTypes:"media:image") {
      displayName
      ... on media_Image {
        imageUrl(scale:"block(800,200)",type:absolute)
      }
    }
  }
}
----

=== HTML

HTML fields are generated with a parameter "processHtml" allowing to replace abstract internal links by generated URLs. 

==== Example: Process HTML

Query example: Retrieve the Superhero blog posts. For each post, return its author display name, tags and processed content.

----
{
  guillotine {
    query(contentTypes:"com.enonic.app.myapp:post") {
      ... on com_enonic_app_myapp_Post {
        data {
          author {
            displayName
          }
          tags
          post(processHtml:{type:absolute})
        }
      }
    }
  }
}
----

=== Static GraphQL types

The documentation, linked below, lists and describes all static GraphQL types generated by Guillotine

link:static.html[Static GraphQL types documentation]
